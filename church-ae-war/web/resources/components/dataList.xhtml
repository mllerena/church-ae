<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:ae="http://primefaces.org/aeopensolutions"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:o="http://omnifaces.org/ui">

    <ae:default var="rendered" value="true" />

    <ae:default var="renderedNew" value="true" />
    <ae:default var="renderedEdit" value="true" />
    <ae:default var="renderedSave" value="true" />
    <ae:default var="renderedDelete" value="true" />
    <ae:default var="renderedCancel" value="true" />
    <ae:default var="renderedProcess" value="false" />
    <ae:default var="renderedGenerate" value="false" />


    <ae:default var="labelNew" value="Nuevo" />
    <ae:default var="labelEdit" value="Editar" />
    <ae:default var="labelSave" value="Guardar" />
    <ae:default var="labelDelete" value="Eliminar" />
    <ae:default var="labelCancel" value="Cancelar" />
    <ae:default var="labelProcess" value="Procesar" />
    <ae:default var="labelGenerate" value="Generar" />

    <ae:default var="messageDelete" value="¿Está seguro de eliminar la selección de registro(s)?" />

    <ae:default var="editable" value="#{true}" />

    <ae:default var="rows" value="5" />



    <style type="text/css">
        .ui-toolbar-group-left{
            line-height: 25px;
        }

        .ui-toolbar-group-left > span{
            display: inline-block;
            vertical-align: middle;
            line-height: 1em; /*set line height back to normal*/
            margin-left: 2px;
        }

        .rowEdited {
            background-color: #2191c0 !important;
            background-image: none !important;
            color: #ffffff !important;
        }

    </style>


    <ae:context toolbarId="toolbar_#{id}" listId="list_#{id}" editId="modal_#{id}"  data="#{value.dataTable}" dataList="#{value}"> 

        <h:panelGrid columns="1" id="#{id}" cellpadding="0" cellspacing="1" rendered="#{rendered}">
            <p:toolbar id="#{toolbarId}">
                <f:facet name="left">
                    <span style="color: #546e7a;">#{title}</span>
                </f:facet>
                <f:facet name="right">

                    <p:commandButton icon="ui-icon-plus" id="cbNew_#{id}" oncomplete="PF('wvEdit_').show();" process="@this" update=" #{toolbarId} #{listId}"
                                     actionListener="#{dataList.actionCreate}" value="#{labelNew}" rendered="#{renderedNew}" disabled="#{not dataList.enabledCreate}"> 
                        <f:actionListener type="org.omnifaces.eventlistener.ResetInputAjaxActionListener" />
                    </p:commandButton>

                    <p:commandButton icon="ui-icon-pencil" id="cbEdit_#{id}" oncomplete="PF('wvEdit_').show();" process="@this" update=""
                                     actionListener="#{dataList.actionEdit}" value="#{labelEdit}" rendered="#{not (empty data) and renderedEdit}" disabled="#{not dataList.enabledEdit}">
                        <f:actionListener type="org.omnifaces.eventlistener.ResetInputAjaxActionListener" />
                    </p:commandButton>

                    <p:commandButton icon="ui-icon-disk" 
                                     id="cbSave_#{id}" process="@this" update="#{toolbarId} #{listId}"
                                     actionListener="#{dataList.actionMultiSave}"  value="#{labelSave}" rendered="#{not (empty data) and renderedSave}" disabled="#{not dataList.enabledSave}">
                    </p:commandButton>				

                    <p:commandButton icon="ui-icon-trash" 
                                     id="cbDelete_#{id}" process="@this" update="#{toolbarId} #{listId}"
                                     actionListener="#{dataList.actionDelete}" value="#{labelDelete}" rendered="#{not (empty data) and renderedDelete}" disabled="#{not dataList.enabledDelete}"> 
                        <p:confirm header="Confirmación" message="#{messageDelete}"
                                   icon="ui-icon-alert"  />
                    </p:commandButton>



                    <p:commandButton icon="ui-icon-cancel" 
                                     process="@this" update="#{toolbarId} #{listId}"
                                     actionListener="#{dataList.actionCancel}" disabled="#{not dataList.enabledCancel}"
                                     id="cbCancel_#{id}" rendered="#{not (empty data) and renderedCancel}" value="#{labelCancel}">
                    </p:commandButton>

                    <p:commandButton icon="ui-icon-check" 
                                     process="@this" 
                                     actionListener="#{dataList.actionProcess}"
                                     id="cbProcess_#{id}" rendered="#{not (empty data) and renderedProcess}" value="#{labelProcess}" disabled="#{not dataList.enabledProcess}">
                    </p:commandButton>	

                    <p:commandButton icon="ui-icon-transferthick-e-w"
                                     process="@this" update="#{toolbarId} #{listId}"
                                     actionListener="#{dataList.actionGenerate}"
                                     id="cbGenerate_#{id}" rendered="#{not (empty data) and renderedGenerate}" value="#{labelGenerate}" disabled="#{not dataList.enabledGenerate}"> 
                    </p:commandButton>

                    <ui:insert name="extraButtons" />



                </f:facet>

            </p:toolbar>

            <ae:dataTable id="#{listId}" dataTable="#{data}" selectedRecords="#{dataList.rowSelectCountTotal}" totalRecords="#{dataList.rowCountTotal}" totalModified="#{dataList.rowModifiedCountTotal}"
                          rowKey="#{rowKey}"  selectionMode="multiple"  
                          selection="#{dataList.selectItems}" editable="#{editable}" rowStyleClass="#{row.change? 'rowEdited' : null}" rows="#{rows}"  >
                <p:column headerText="" style="width:16px;text-align:center" >
                    <h:panelGroup rendered="#{row.change}" style="padding:0px;spacing:0px;">
                        <img src="../images/pencil.png" />
                    </h:panelGroup>
                </p:column>
                <ae:context header="">
                    <ui:insert />
                </ae:context> 
                <ui:define name="events">
                    <p:ajax event="toggleSelect" listener="#{dataList.onRowSelect()}" process="#{listId}" update="@parent:#{toolbarId} #{listId}"/>

                    <p:ajax event="rowSelectCheckbox" listener="#{dataList.onRowSelect()}" process="#{listId}"  update="@parent:#{toolbarId} #{listId}"/> 
                    <p:ajax event="rowUnselectCheckbox" listener="#{dataList.onRowUnselect()}" process="#{listId}" update="@parent:#{toolbarId} #{listId}"/>

                    <p:ajax event="cellEdit" listener="#{dataList.onCellEdit(row,listId)}" ignoreAutoUpdate="true" process="@this" />     

                </ui:define> 


            </ae:dataTable>

            <p:remoteCommand name="onCellEditEvent#{listId}" update="@parent:#{toolbarId} #{listId}" process="@parent:#{toolbarId} #{listId}"></p:remoteCommand>    

            <h:outputScript>

                function handleEdit(xhr, status, args) {
                console.log("args.warn: "+args.warn);
                if(!args.warn) {
                PF('wvNew_').show();
                }
                }

            </h:outputScript>


        </h:panelGrid>




    </ae:context>




</ui:composition>